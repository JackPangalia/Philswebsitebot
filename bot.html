<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bot</title>
  </head>
  <body>
    <div id="chatbot-container">
      <div id="chatbot-top-bar-area">
        <div id = 'chatbot-top-bar-area-logo'>
          <image src = '/dp-logo-hor-2023.png' />
          <!-- <h3>How can we help you</h3> -->
        </div>

        <button>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6 18 18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>

      <div id="chatbot-message-area">
        <!-- Messages will be added here dynamically -->
      </div>

      <div id="chatbot-input-area">
        <input id="chatbot-input" placeholder="Ask me anything" />
        <button id="send-btn">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"
            />
          </svg>
        </button>
      </div>
    </div>

    <script>
      // Function to parse and format the AI response
      // Function to parse and format the AI response
      function formatAIResponse(response) {
        const lines = response.split("\n");
        let formattedResponse = "";
        let inList = false;

        for (let line of lines) {
          if (line.trim().startsWith("-")) {
            if (!inList) {
              // Start a new list if we're not already in one
              formattedResponse += "<ul class = 'bullet-point-ul'>";
              inList = true;
            }
            // Add list item
            formattedResponse +=
              "<li>" + line.trim().substring(1).trim() + "</li>";
          } else {
            if (inList) {
              // Close the list if we were in one
              formattedResponse += "</ul>";
              inList = false;
            }
            formattedResponse += line + "<br>";
          }
        }

        // Close the list if the response ends with a list item
        if (inList) {
          formattedResponse += "</ul>";
        }

        return formattedResponse;
      }

      // Function to append a new message to the chat area
      function appendMessage(message, className) {
        const messageArea = document.getElementById("chatbot-message-area");
        const messageDiv = document.createElement("div");
        messageDiv.className = className;

        if (className === "chatbot-message") {
          messageDiv.innerHTML = formatAIResponse(message);
        } else {
          messageDiv.textContent = message;
        }

        messageArea.appendChild(messageDiv);
        messageArea.scrollTop = messageArea.scrollHeight;
      }

      // Function to handle the API call
      async function sendMessageToAPI(userMessage) {
        try {
          const response = await fetch("http://localhost:3000/message", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ message: userMessage }),
          });

          const data = await response.json();
          return data.aiMessage; // Adjust to match the actual response structure from your API
        } catch (error) {
          console.error("Error:", error);
          return "Sorry, something went wrong.";
        }
      }

      // Event listener for the send button
      document
        .getElementById("send-btn")
        .addEventListener("click", async () => {
          const userInput = document.getElementById("chatbot-input").value;
          if (!userInput) return; // Exit if input is empty

          // Display user's message
          appendMessage(userInput, "user-message");

          // Send the message to the API and get the response
          const aiResponse = await sendMessageToAPI(userInput);

          // Display AI's response
          appendMessage(aiResponse, "chatbot-message");

          // Clear the input field
          document.getElementById("chatbot-input").value = "";
        });
    </script>

    <style>
      /* Your existing styles */
      * {
        margin: 0px;
        font-family: Arial, Helvetica, sans-serif;
      }

      #chatbot-container {
        border-radius: 1rem;
        position: absolute;
        right: 1.5vw;
        bottom: 2.5vh;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        border-bottom-left-radius: 1rem;
        background-color: white;
        width: 31rem;
      }

      #chatbot-top-bar-area {
        border-top-right-radius: 1rem;
        border-top-left-radius: 1rem;
        display: flex;
        justify-content: space-between;
        background-color: #09090b;
        padding: 1.3rem;
        color: white;
        font-size: 0.8rem;
      }

      #chatbot-top-bar-area button {
        outline: none;
        border: none;
        background-color: transparent;
        padding: 0px;
        width: 1.3rem;
        height: 1rem;
      }

      #chatbot-top-bar-area-logo {
        display: flex;
      }

      #chatbot-top-bar-area-logo img {
        width:rem;
      }


      #chatbot-top-bar-area button:hover {
        cursor: pointer;
      }

      #chatbot-top-bar-area button svg {
        color: white;
      }

      #chatbot-message-area {
        overflow-y: scroll;
        gap: 1rem;
        padding-block: 1rem;
        height: 45vh;
        font-size: 0.95rem;
        display: flex;
        flex-direction: column;
      }

      .user-message {
        border-radius: 0.5rem;
        margin-right: 0.5rem;
        margin-left: auto;
        width: 72%;
        padding: 1.7rem;
        color: white;
        background-color: #09090b;
      }

      .chatbot-message {
        border-radius: 0.5rem;
        margin-left: 0.5rem;
        margin-right: auto;
        width: 72%;
        padding: 1.7rem;
        background-color: #f3f4f6;
      }

      .bullet-point-ul {
        margin-block: 1rem;
      }

      #chatbot-input-area {
        border-bottom-right-radius: 1rem;
        border-bottom-left-radius: 1rem;
        gap: 0.5rem;
        justify-content: space-between;
        display: flex;
        padding: 1rem;
      }

      #chatbot-input-area input {
        color: black;
        background-color: transparent;
        outline: none;
        padding-inline: 1rem;
        padding-block: 0.5rem;
        width: 100%;
        border: #374151 solid 1px;
        border-radius: 1rem;
        font-size: 1rem;
      }

      #chatbot-input-area button {
        outline: none;
        border: none;
        background-color: transparent;
        padding: 0px;
        width: 1.9rem;
      }

      #chatbot-input-area button:hover {
        cursor: pointer;
      }
    </style>
  </body>
</html>
